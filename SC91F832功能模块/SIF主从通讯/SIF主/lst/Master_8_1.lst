C51 COMPILER V9.03   MASTER_8_1                                                            04/16/2014 15:37:57 PAGE 1   


C51 COMPILER V9.03, COMPILATION OF MODULE MASTER_8_1
OBJECT MODULE PLACED IN .\output\Master_8_1.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE c\Master_8_1.c BROWSE DEBUG OBJECTEXTEND PRINT(.\lst\Master_8_1.lst) OBJECT
                    -(.\output\Master_8_1.obj)

line level    source

   1          //************************************************************
   2          //  Copyright (c) 深圳市赛元微电子有限公司
   3          //      文件名称        : master_8_1.c
   4          //      作者            : 
   5          //      模块功能        : SIF master 8+1基础通讯模块
   6          //      局部函数列表:
   7          //  最后更正日期:
   8          //      版本            :
   9          //      更改记录        :
  10          //*************************************************************
  11          #include "H\SC91F832_C.H"
  12          
  13          //============================
  14          //模块内常量定义
  15          //============================
  16          #define         SIF_MASTER_ACK          0x00            //SIF主8+1通讯模式
  17          
  18          //*************************************************************
  19          // 函数名       ：void sif_init(void)
  20          // 作者         ：
  21          // 功能         ：sif初始化
  22          // 参数         ：无
  23          // 返回值       ：无
  24          // 调用全局变量：无
  25          // 修改全局变量：无
  26          // 备注         ：
  27          //**************************************************************
  28          void sif_init(void)
  29          {
  30   1              P1CFG1 &= 0x0F;         //设置P16、P17状态为准双向模式
  31   1              P1 |= 0xC0;         //设置P16、P17输出高
  32   1              SIFCFG = SIF_MASTER_ACK;  //选择SIF主8+1通讯模式
  33   1              SIFCFG |= 0x80;         //打开SIF       
  34   1      }
  35          
  36          //*************************************************************
  37          // 函数名       ：void send_start(void)
  38          // 作者         ：
  39          // 功能         ：主发送start
  40          // 参数         ：无
  41          // 返回值       ：无
  42          // 调用全局变量：无
  43          // 修改全局变量：无
  44          // 备注         ：
  45          //**************************************************************
  46          void send_start(void)
  47          {
  48   1              SIFCTL = 0x01;                  //发送start
  49   1              while(STRIF == 0);              //完成start,该bit硬件置1
  50   1              STRIF = 0;                              //清除send start完成标志        
  51   1      }
  52          
  53          //*************************************************************
  54          // 函数名       ：void send_stop(void)
C51 COMPILER V9.03   MASTER_8_1                                                            04/16/2014 15:37:57 PAGE 2   

  55          // 作者         ：
  56          // 功能         ：主发送stop
  57          // 参数         ：无
  58          // 返回值       ：无
  59          // 调用全局变量：无
  60          // 修改全局变量：无
  61          // 备注         ：
  62          //**************************************************************
  63          void send_stop(void)
  64          {
  65   1              SIFCTL = 0x00;                  //发送stop
  66   1              while(STPIF == 0);              //完成stop,该bit硬件置1
  67   1              STPIF = 0;                              //清除send stop完成标志 
  68   1      }
  69          
  70          //*************************************************************
  71          // 函数名       ：void send_byte(unsigned char sif_send_byte)
  72          // 作者         ：
  73          // 功能         ：主发送 1 byte的数据
  74          // 参数         ：unsigned char sif_send_byte
  75          // 返回值       ：无
  76          // 调用全局变量：无
  77          // 修改全局变量：无
  78          // 备注         ：
  79          //**************************************************************
  80          void send_byte(unsigned char sif_send_byte)
  81          {
  82   1              SIFTXD = sif_send_byte;
  83   1              SIFCTL = 0x02;                  //发送数据
  84   1              while(TXIF == 0);               //完成发送,该bit硬件置1
  85   1              TXIF = 0;                               //清除发送完成标志      
  86   1      }
  87          
  88          //*************************************************************
  89          // 函数名       ：void send_byte(unsigned char sif_send_byte)
  90          // 作者         ：
  91          // 功能         ：主接收 1 byte的数据
  92          // 参数         ：无
  93          // 返回值       ：unsigned char SIFRXD
  94          // 调用全局变量：无
  95          // 修改全局变量：无
  96          // 备注         ：
  97          //**************************************************************
  98          unsigned char receive_byte(void)
  99          {
 100   1              
 101   1              SIFCTL = 0x03;                  //接受数据
 102   1              while(RXIF == 0);               //完成接受,该bit硬件置1
 103   1              RXIF = 0;                               //清除接受完成标志
 104   1              return (SIFRXD);            //读取接收的数据
 105   1      }
 106          
 107          //*************************************************************
 108          // 函数名       ：bit  sif_waitack(void)
 109          // 作者         ：
 110          // 功能         ：读从发来的ACK
 111          // 参数         ：无
 112          // 返回值       ：1/0
 113          // 调用全局变量：无
 114          // 修改全局变量：无
 115          // 备注         ：返回1,有ack;返回0,无ack
 116          //**************************************************************
C51 COMPILER V9.03   MASTER_8_1                                                            04/16/2014 15:37:57 PAGE 3   

 117          bit  sif_waitack(void)
 118          {
 119   1              return (!RTNACK);       
 120   1      }
 121          
 122          //*************************************************************
 123          // 函数名       ：void  sif_ack(void)
 124          // 作者         ：
 125          // 功能         ：发送应答信号
 126          // 参数         ：无
 127          // 返回值       ：无
 128          // 调用全局变量：无
 129          // 修改全局变量：无
 130          // 备注         ：
 131          //**************************************************************
 132          void  sif_ack(void)
 133          {
 134   1              SIFCFG &= ~0x01;                                //发送应答
 135   1      }
 136          
 137          //*************************************************************
 138          // 函数名       ：void  sif_noack(void)
 139          // 作者         ：
 140          // 功能         ：发送无应答信号
 141          // 参数         ：无
 142          // 返回值       ：无
 143          // 调用全局变量：无
 144          // 修改全局变量：无
 145          // 备注         ：
 146          //**************************************************************
 147          void  sif_noack(void)
 148          {
 149   1              SIFCFG |= 0x01;                                  //发送无应答
 150   1      }
 151          
 152          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     65    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
